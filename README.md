🧩 Step 0 — Overview

We’re going to build a bot that:

Listens to WhatsApp messages in real time (via Meta’s Webhook)

Responds intelligently using OpenAI (ChatGPT API)

Runs locally using Flask

Exposes to the internet using ngrok

You’ll send a message from your phone → Meta forwards it to your Flask app → Flask sends it to OpenAI → the bot replies on WhatsApp.

⚙️ Step 1 — Set Up Prerequisites
1️⃣ Meta Developer Account

Go to: https://developers.facebook.com

Click Create App → Other → Business

Add WhatsApp to your app (under “Add Products”).

2️⃣ WhatsApp Test Number

Inside your Meta App, go to WhatsApp → API Setup

You’ll get a temporary test phone number

You can message up to 5 numbers (add your own number to test)

3️⃣ OpenAI Account

Get your API key from: https://platform.openai.com/api-keys

🧾 Step 2 — Create Your Python Project
mkdir whatsapp-ai-bot
cd whatsapp-ai-bot
python3 -m venv venv
source venv/bin/activate
pip install flask requests python-dotenv openai

🧱 Step 3 — Project Structure
whatsapp-ai-bot/
│
├── .env
├── run.py
├── whatsapp_utils.py
└── openai_service.py

🔑 Step 4 — Create the .env File
VERIFY_TOKEN=your_verify_token
ACCESS_TOKEN=your_long_lived_meta_access_token
PHONE_NUMBER_ID=your_whatsapp_phone_number_id
OPENAI_API_KEY=your_openai_key

🧠 Step 5 — openai_service.py
import openai
import os
from dotenv import load_dotenv

load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")

def generate_response(message):
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": message}]
    )
    return response['choices'][0]['message']['content']

💬 Step 6 — whatsapp_utils.py
import requests
import os
from dotenv import load_dotenv
from openai_service import generate_response

load_dotenv()

ACCESS_TOKEN = os.getenv("ACCESS_TOKEN")
PHONE_NUMBER_ID = os.getenv("PHONE_NUMBER_ID")

def send_whatsapp_message(recipient, message):
    url = f"https://graph.facebook.com/v18.0/{PHONE_NUMBER_ID}/messages"
    headers = {
        "Authorization": f"Bearer {ACCESS_TOKEN}",
        "Content-Type": "application/json"
    }
    data = {
        "messaging_product": "whatsapp",
        "to": recipient,
        "type": "text",
        "text": {"body": message}
    }
    requests.post(url, headers=headers, json=data)

def process_whatsapp_message(entry):
    for change in entry.get("changes", []):
        value = change.get("value", {})
        messages = value.get("messages", [])
        for msg in messages:
            from_number = msg["from"]
            user_text = msg["text"]["body"]
            print(f"Message from {from_number}: {user_text}")
            ai_reply = generate_response(user_text)
            send_whatsapp_message(from_number, ai_reply)

🚀 Step 7 — run.py (Flask App)
from flask import Flask, request
from whatsapp_utils import process_whatsapp_message
import os
from dotenv import load_dotenv

load_dotenv()
app = Flask(__name__)

VERIFY_TOKEN = os.getenv("VERIFY_TOKEN")

@app.route('/webhook', methods=['GET'])
def verify_webhook():
    if request.args.get("hub.verify_token") == VERIFY_TOKEN:
        return request.args.get("hub.challenge")
    return "Invalid verification token", 403

@app.route('/webhook', methods=['POST'])
def receive_message():
    data = request.get_json()
    print(data)
    if data.get("object") == "whatsapp_business_account":
        process_whatsapp_message(data['entry'][0])
    return "OK", 200

if __name__ == '__main__':
    app.run(port=8000, debug=True)

🌍 Step 8 — Expose Your App with ngrok

Install ngrok:

npm install -g ngrok
ngrok config add-authtoken <YOUR_AUTHTOKEN>
ngrok http 8000


Copy your URL like:

https://your-domain.ngrok-free.app

🔗 Step 9 — Set Up Webhook in Meta

Go to your Meta App → WhatsApp > Configuration

Callback URL → https://your-domain.ngrok-free.app/webhook

Verify Token → (same as in .env)

Click Verify and Save

Subscribe to “messages” field

You should see WEBHOOK_VERIFIED in your Flask terminal.

📲 Step 10 — Test the Bot

Add your test number to WhatsApp contacts

Send a message like “Hi bot”

You’ll receive a reply generated by OpenAI 🎉

🧠 Step 11 — Going Further

Deploy to production (Render, Railway, or AWS)

Add context memory (save chat history in SQLite)

Support buttons, images, or voice

Add your own AI personality (“You are a friendly assistant”)

Connect multiple numbers via the Meta Business API